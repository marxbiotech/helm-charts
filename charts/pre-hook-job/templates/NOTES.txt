{{- if .Values.job.enabled }}
pre-hook-job "{{ include "pre-hook-job.jobName" . }}" is configured as a Helm pre-install/pre-upgrade hook.

  Hook weight:         {{ .Values.job.hookWeight }}
  Hook delete policy:  {{ .Values.job.hookDeletePolicy }}
  Image:               {{ .Values.image.repository }}{{ if .Values.image.digest }}@{{ .Values.image.digest }}{{ else }}:{{ .Values.image.tag }}{{ end }}
  Backoff limit:       {{ .Values.job.backoffLimit }}

The Job will run automatically before the main application is installed or upgraded.

To check Job status after a release:
  kubectl get jobs -l "app.kubernetes.io/instance={{ .Release.Name }},app.kubernetes.io/component=pre-hook" -n {{ .Release.Namespace }}

{{- if not (kindIs "invalid" .Values.job.ttlSecondsAfterFinished) }}
To view Job logs (available for {{ .Values.job.ttlSecondsAfterFinished }}s after completion, or until the next install/upgrade — whichever comes first):
{{- else }}
To view Job logs (available until the next install/upgrade):
{{- end }}
  kubectl logs job/{{ include "pre-hook-job.jobName" . }} -n {{ .Release.Namespace }}

⚠️  UPGRADE NOTE (v0.3.0): Default hookDeletePolicy changed from "hook-failed" to "before-hook-creation".
  If you relied on the old default, set job.hookDeletePolicy=hook-failed explicitly.
{{- else }}
pre-hook-job is disabled (job.enabled=false). No resources were created.
{{- end }}
